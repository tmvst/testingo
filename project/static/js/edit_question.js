// Generated by CoffeeScript 1.6.3
(function() {
  var check_template, delete_entry, form_submit, get_cnt, input_template, ix, phrase_template, radio_template;

  ix = 0;

  get_cnt = function(ix) {
    ix = $('input.indikator').length;
    return ix;
  };

  check_template = function() {
    return "<div class=\"answerblock\">\n<input class=\"indikator checkInputC\" type=\"checkbox\" name=\"ind" + ix + "\" value=\"\">\n<input class=\"text form-control radiotext\" name=\"text" + ix + "\">\n<div class=\"btn btn-default btn-sm delete-button\"> Zmazať </div> <br>\n</div>";
  };

  radio_template = function() {
    return "<div class=\"answerblock\">\n<input class=\"indikator checkInputC\" type=\"radio\" name=\"radio\" value=\"ind" + ix + "\">\n<input class=\"text form-control radiotext\" name=\"text" + ix + "\">\n<div class=\"btn btn-default btn-sm delete-button\"> Zmazať </div> <br>\n</div>";
  };

  phrase_template = function() {
    return "<div class=\"answerblock\">\n<label for=\"odpoved\"></label>\n<input class=\"text form-control radiotext indikator\" name=\"odpoved\" id=\"text" + ix + "\" placeholder=\"Správna odpoveď\">\n<div class=\"btn btn-default btn-sm delete-button\"> Zmazať </div>\n</div>";
  };

  input_template = function(Qtyp) {
    ix = get_cnt(ix);
    ix++;
    if (Qtyp === "S") {
      $('#input_answer_showQ').append(phrase_template());
    }
    if (Qtyp === "R") {
      $('#input_answer_showQ').append(radio_template());
    }
    if (Qtyp === "C") {
      return $('#input_answer_showQ').append(check_template());
    }
  };

  delete_entry = function(e) {
    return $(e.target).parent().remove();
  };

  form_submit = function(redir, type) {
    var answers, bodyQ, correctness, is_q_mandatory, textQ;
    $('#form_showQ').validate({
      rules: {
        text: {
          required: true
        },
        points: {
          number: true
        }
      },
      messages: {
        text: "Prosím zadajte text otázky",
        points: {
          number: "Body musia byť číslo"
        }
      }
    });
    if ($('#form_showQ').valid()) {
      textQ = $("textarea[name='text']").val();
      bodyQ = $("input[name='points']").val();
      console.log(bodyQ);
      if ($("textarea.text").val()) {
        answers = $("textarea.text").val();
        correctness = true;
      } else {
        answers = [];
        $("input.text").each(function() {
          return answers.push([parseInt($(this).attr('name').substr(4)), $(this).val()]);
        });
        correctness = $("input.indikator").serializeArray();
      }
      is_q_mandatory = $('#is_q_mandatory').is(':checked');
      console.log(answers);
      console.log(correctness);
      $.ajax({
        url: post_url,
        type: "POST",
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify({
          text: textQ,
          points: bodyQ,
          type: type,
          answers: answers,
          correctness: correctness,
          is_q_mandatory: is_q_mandatory
        })
      }).done(function(response) {
        return top.location.href = redir;
      }).fail(function(response) {
        return console.log(response);
      });
    }
    return false;
  };

  $(document).ready(function() {
    $('#save_changes').click(function() {
      return form_submit(post_url, this.name);
    });
    $('#create_answer_showQ').click(function() {
      return input_template(this.name);
    });
    return $('#odpovede_showQ').on('click', '.delete-button', delete_entry);
  });

}).call(this);
