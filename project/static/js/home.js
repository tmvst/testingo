// Generated by CoffeeScript 1.6.3
(function() {
  var form_submit;

  form_submit = function(redir) {
    var email, name, pass;
    $('#form-signin').validate({
      rules: {
        login: {
          required: true
        },
        email: {
          email: true,
          required: true
        },
        password: {
          required: true,
          minlength: 6
        }
      },
      messages: {
        login: "Prosím zadajte meno",
        email: {
          required: "Prosím zadajte email",
          email: "Emailová adresa je v zlom tvare"
        },
        password: {
          required: "Prosím zadajte heslo",
          minlength: "Heslo musí mať aspoň 6 znakov"
        }
      },
      errorPlacement: function(error, element) {
        return element.popover({
          trigger: "focus",
          placement: "left",
          content: error.html()
        });
      }
    });
    if (!$('#form-signin').valid()) {
      if ($(".sred").length === 0) {
        $(".form-signin-heading").append(" <small class=\"sred\"><span class=\"glyphicon glyphicon-exclamation-sign\"></span></small>");
      }
      $(".sred").tooltip({
        title: "Formulár obsahuje chyby"
      });
      $(".sred").tooltip("show");
    }
    if ($('#form-signin').valid()) {
      name = $("input[name='login']").val();
      email = $("input[name='email']").val();
      pass = $("input[name='password']").val();
      $.ajax({
        url: post_url,
        type: "POST",
        contentType: "application/json; charset=utf-8",
        data: JSON.stringify({
          login: name,
          email: email,
          password: pass
        }),
        success: function(response) {
          console.log(response["errors"]);
          if (response["errors"]) {
            console.log("Email exists!");
            return false;
          } else {
            return top.location.href = "/dashboard";
          }
        },
        error: function() {
          return console.log("Error");
        }
      }).done(function() {
        console.log("Done");
        return top.location.href = "/dashboard";
      }).fail(function(response) {
        return console.log(response);
      });
    }
    return false;
  };

  $(document).ready(function() {
    return $('#submit').click(function() {
      return form_submit(post_url);
    });
  });

}).call(this);
